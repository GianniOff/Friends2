<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Gianni Navigator | Dossiers Complets</title>
    <style>
        :root { --bg: #0a0a12; --card: #151525; --accent: #00f2ff; --text: #e0e0e0; }
        body { background: var(--bg); color: var(--text); font-family: 'Segoe UI', sans-serif; padding: 20px; }
        .container { max-width: 1100px; margin: auto; }
        
        .header { display: flex; justify-content: space-between; border-bottom: 2px solid var(--accent); padding-bottom: 10px; margin-bottom: 30px; }
        
        /* Grid des Dossiers */
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 20px; }
        .dossier-card { background: var(--card); border-radius: 15px; padding: 20px; border-left: 5px solid var(--accent); }
        .dossier-card h2 { margin: 0; color: var(--accent); }
        .info-row { font-size: 0.8em; color: #aaa; margin: 5px 0; }
        
        /* Stats */
        .stat-bar { background: #000; height: 8px; border-radius: 4px; margin: 8px 0; overflow: hidden; }
        .stat-fill { height: 100%; transition: width 0.6s; }

        /* Formulaires Admin */
        #admin-panel { display: none; background: #1a1a30; padding: 25px; border-radius: 15px; margin-top: 40px; }
        .form-group { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px; }
        input, textarea, select { background: #0a0a12; color: white; border: 1px solid #333; padding: 10px; border-radius: 5px; }
        button { background: var(--accent); color: black; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-weight: bold; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1>üìë ARCHIVES GIANNI</h1>
        <button style="background:transparent; color:white; border:1px solid #333;" onclick="unlock()">üîí Acc√®s Root</button>
    </div>

    <div id="app" class="grid"></div>

    <div id="admin-panel">
        <h2 style="color:var(--accent)">üÜï Nouveau Dossier Complet</h2>
        <div class="form-group">
            <input type="text" id="id" placeholder="ID Unique (ex: GianniB)">
            <select id="cat">
                <option value="üéÆ Jeux Vid√©o">üéÆ Jeux Vid√©o</option>
                <option value="üè´ √âcole">üè´ √âcole</option>
                <option value="üèÄ Sport">Sport</option>
            </select>
            <input type="text" id="prenom" placeholder="Pr√©nom">
            <input type="text" id="nom" placeholder="Nom">
            <input type="date" id="dob">
            <textarea id="bio" placeholder="Notes / Biographie rapide" style="grid-column: span 2"></textarea>
        </div>
        <button onclick="createDossier()">CR√âER LE DOSSIER</button>
        
        <hr style="margin: 20px 0; border: 0; border-top: 1px solid #333;">
        
        <h3>üìà Modifier les Statistiques</h3>
        <input type="text" id="upd-id" placeholder="ID de l'ami">
        <select id="upd-stat">
            <option value="Loyaut√©">Loyaut√©</option>
            <option value="Respect">Respect</option>
            <option value="Skill">Skill</option>
        </select>
        <input type="number" id="upd-val" placeholder="+/- %">
        <button onclick="updateStat()">MODIFIER</button>
    </div>
</div>

<script>
    const API_URL = "https://economically-pseudoetymological-serenity.ngrok-free.dev";
    let myCode = "";

    function unlock() {
        const c = prompt("Code d'acc√®s :");
        if(c === "ExpA22") { myCode = c; document.getElementById('admin-panel').style.display = "block"; }
    }

    async function load() {
        const res = await fetch(`${API_URL}/data`, { headers: {"ngrok-skip-browser-warning": "1"} });
        const data = await res.json();
        const app = document.getElementById('app');
        app.innerHTML = "";

        for (const [id, info] of Object.entries(data)) {
            let html = `
                <div class="dossier-card">
                    <small style="float:right">${info.category}</small>
                    <h2>${info.prenom} ${info.nom.toUpperCase()}</h2>
                    <div class="info-row">üìÖ N√© le : ${info.dob}</div>
                    <div style="font-size:0.85em; margin: 10px 0;"><em>"${info.bio}"</em></div>
                    <hr style="border:0; border-top:1px solid #222">`;
            
            for (const [sName, sVal] of Object.entries(info.stats)) {
                let color = sVal > 50 ? "#00ff88" : "#ff2e63";
                html += `
                    <div style="font-size:0.7em; margin-top:10px;">${sName.toUpperCase()} : ${sVal}%</div>
                    <div class="stat-bar"><div class="stat-fill" style="width:${sVal}%; background:${color}"></div></div>`;
            }
            html += `</div>`;
            app.innerHTML += html;
        }
    }

    async function createDossier() {
        await fetch(`${API_URL}/create_dossier`, {
            method: 'POST',
            headers: {'Content-Type': 'application/json', "ngrok-skip-browser-warning": "1"},
            body: JSON.stringify({
                ami_id: document.getElementById('id').value,
                prenom: document.getElementById('prenom').value,
                nom: document.getElementById('nom').value,
                dob: document.getElementById('dob').value,
                bio: document.getElementById('bio').value,
                category: document.getElementById('cat').value,
                access_code: myCode
            })
        });
        load();
    }

    async function updateStat() {
        await fetch(`${API_URL}/update_stat`, {
            method: 'POST',
            headers: {'Content-Type': 'application/json', "ngrok-skip-browser-warning": "1"},
            body: JSON.stringify({
                ami_id: document.getElementById('upd-id').value,
                stat_name: document.getElementById('upd-stat').value,
                change: parseInt(document.getElementById('upd-val').value),
                access_code: myCode
            })
        });
        load();
    }

    setInterval(load, 5000);
    load();
</script>
</body>
</html>
