<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Navigator v9 | Classified Edition</title>
    <style>
        :root { --bg: #030508; --card: #0d1117; --accent: #3b82f6; --text: #f0f6fc; --danger: #f85149; --censored: #000; }
        body { background: var(--bg); color: var(--text); font-family: sans-serif; margin: 0; }
        .navbar { display: flex; justify-content: space-between; align-items: center; padding: 15px 40px; background: #0d1117; border-bottom: 1px solid #30363d; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 20px; padding: 40px; }
        .public-card { background: var(--card); border: 1px solid #30363d; padding: 40px 20px; border-radius: 12px; text-align: center; cursor: pointer; transition: 0.3s; }
        .public-card:hover { border-color: var(--accent); transform: scale(1.02); }
        
        #profile-page { position: fixed; inset: 0; background: var(--bg); z-index: 200; display: none; overflow-y: auto; padding: 40px; }
        .redacted { background: var(--censored); color: var(--censored); user-select: none; border-radius: 3px; padding: 0 4px; }
        
        .admin-box { background: #161b22; border: 1px dashed var(--accent); padding: 25px; border-radius: 12px; margin-top: 40px; }
        .censure-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 10px; background: #0d1117; padding: 15px; border-radius: 8px; margin: 15px 0; }
        
        input, select, textarea { width: 100%; background: #0d1117; border: 1px solid #30363d; color: white; padding: 10px; border-radius: 6px; box-sizing: border-box; }
        .btn { padding: 12px 20px; border-radius: 8px; cursor: pointer; border: none; font-weight: bold; }
        .stat-fill { background: var(--accent); height: 8px; border-radius: 4px; transition: 1s; }
    </style>
</head>
<body>

<div class="navbar">
    <div style="font-weight: 900; color: var(--accent); font-size: 1.5rem;">NAVIGATOR <span style="color:white">v9</span></div>
    <div style="display:flex; gap:10px;">
        <button id="btn-new" onclick="openNew()" style="display:none; background:var(--accent); color:white;" class="btn">+ Cr√©er</button>
        <button id="admin-btn" onclick="askAdmin()" class="btn" style="background:none; border:1px solid #333; color:white;">Mode Admin</button>
    </div>
</div>

<div class="grid" id="main-grid"></div>

<div id="profile-page">
    <button onclick="closeProfile()" class="btn" style="background:#333; color:white; margin-bottom:20px;">‚Üê Quitter le dossier</button>
    
    <div style="max-width: 800px; margin: auto;">
        <div style="display:flex; gap:30px; margin-bottom:40px;">
            <img id="v-avatar" style="width:150px; height:150px; border-radius:15px; object-fit:cover; background:#111;">
            <div style="flex:1">
                <h1 id="v-name" style="margin:0"></h1>
                <p id="v-job" style="color:var(--accent); font-weight:bold; margin:5px 0;"></p>
                <div id="v-loc" style="font-size:0.9rem; color:#8b949e"></div>
                <div id="v-level" style="margin-top:10px; font-size:12px; border:1px solid #333; display:inline-block; padding:2px 8px; border-radius:4px;"></div>
            </div>
        </div>

        <div style="background:#0d1117; padding:25px; border-radius:12px; border:1px solid #30363d;">
            <h3>NOTES DE TERRAIN</h3>
            <p id="v-bio" style="line-height:1.6; white-space: pre-wrap;"></p>
        </div>

        <div id="v-stats" style="margin-top:30px;"></div>

        <div id="admin-editor" class="admin-box" style="display:none;">
            <h2 style="color:var(--accent); margin-top:0;">Param√®tres de Confidentialit√©</h2>
            <p style="font-size:12px; color:#8b949e;">Cochez les informations √† censurer pour les utilisateurs non-admin :</p>
            
            <div class="censure-grid" id="censure-checks">
                <label><input type="checkbox" value="prenom"> Pr√©nom</label>
                <label><input type="checkbox" value="nom"> Nom</label>
                <label><input type="checkbox" value="profession"> Profession</label>
                <label><input type="checkbox" value="localisation"> Localisation</label>
                <label><input type="checkbox" value="bio"> Notes / Bio</label>
                <label><input type="checkbox" value="stats"> Statistiques</label>
                <label><input type="checkbox" value="avatar"> Avatar</label>
            </div>

            <h3>√âdition des donn√©es</h3>
            <div style="display:grid; grid-template-columns:1fr 1fr; gap:15px;">
                <input type="text" id="ed-id" placeholder="ID Unique">
                <input type="text" id="ed-pass" placeholder="Mot de Passe Profil">
                <input type="text" id="ed-prenom" placeholder="Pr√©nom">
                <input type="text" id="ed-nom" placeholder="Nom">
                <input type="text" id="ed-job" placeholder="Profession">
                <input type="text" id="ed-loc" placeholder="Localisation">
            </div>
            <textarea id="ed-bio" rows="5" style="margin-top:15px;" placeholder="Biographie compl√®te..."></textarea>
            <input type="text" id="ed-avatar" placeholder="URL Image" style="margin-top:15px;">
            
            <div id="ed-stats-area" style="margin-top:20px;"></div>
            <button onclick="addStatRow()" class="btn" style="width:100%; margin-top:10px; background:#1f2937; color:white;">+ Ajouter Statistique</button>
            <button onclick="save()" class="btn" style="width:100%; margin-top:20px; background:var(--accent); color:white;">üíæ Sauvegarder les modifications</button>
            <button onclick="remove()" class="btn" style="width:100%; margin-top:10px; background:var(--danger); color:white;">Supprimer le dossier</button>
        </div>
    </div>
</div>

<script>
    const API = "https://economically-pseudoetymological-serenity.ngrok-free.dev";
    let ADMIN_CODE = "";

    async function loadPublic() {
        const r = await fetch(`${API}/public_list`, { headers: {"ngrok-skip-browser-warning":"1"} });
        const ids = await r.json();
        const grid = document.getElementById('main-grid');
        grid.innerHTML = ids.map(id => `<div class="public-card" onclick="openProfile('${id}')"><div style="color:var(--accent); font-family:monospace; font-weight:bold;">${id}</div><div style="font-size:9px; margin-top:10px; color:#555">CLASSIFIED DATA</div></div>`).join('');
    }

    async function openProfile(id) {
        let pass = "";
        if(!ADMIN_CODE) {
            pass = prompt("Entrez le mot de passe du profil :");
            if(!pass) return;
        }
        const r = await fetch(`${API}/get_details`, {
            method: 'POST',
            headers: {'Content-Type': 'application/json', "ngrok-skip-browser-warning":"1"},
            body: JSON.stringify({id: id, password: pass, admin_code: ADMIN_CODE})
        });
        if(r.ok) renderProfile(await r.json());
        else alert("Acc√®s refus√©.");
    }

    function renderProfile(d) {
        document.getElementById('profile-page').style.display = "block";
        
        // Fonction pour appliquer le style censur√©
        const format = (val) => val === "‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà" ? `<span class="redacted">${val}</span>` : val;

        document.getElementById('v-avatar').src = d.avatar || "https://via.placeholder.com/150?text=CLASSIFIED";
        document.getElementById('v-name').innerHTML = `${format(d.prenom)} ${format(d.nom)}`;
        document.getElementById('v-job').innerHTML = format(d.profession);
        document.getElementById('v-loc').innerHTML = `Localisation : ${format(d.localisation)}`;
        document.getElementById('v-bio').innerHTML = format(d.bio);
        document.getElementById('v-level').innerText = d.niveau || "ALPHA";

        let sHtml = "<h3>STATISTIQUES</h3>";
        Object.entries(d.stats).forEach(([k,v]) => {
            sHtml += `<div style="margin-top:10px; font-size:12px;">${k}</div><div style="background:#222; border-radius:4px;"><div class="stat-fill" style="width:${v}%"></div></div>`;
        });
        document.getElementById('v-stats').innerHTML = sHtml;

        if(ADMIN_CODE) {
            document.getElementById('admin-editor').style.display = "block";
            document.getElementById('ed-id').value = d.id;
            document.getElementById('ed-id').disabled = true;
            document.getElementById('ed-prenom').value = d.prenom;
            document.getElementById('ed-nom').value = d.nom;
            document.getElementById('ed-pass').value = d.password;
            document.getElementById('ed-job').value = d.profession;
            document.getElementById('ed-loc').value = d.localisation;
            document.getElementById('ed-bio').value = d.bio;
            document.getElementById('ed-avatar').value = d.avatar;
            document.querySelectorAll('#censure-checks input').forEach(cb => cb.checked = d.censored.includes(cb.value));
            document.getElementById('ed-stats-area').innerHTML = "";
            Object.entries(d.stats).forEach(([k,v]) => addStatRow(k,v));
        }
    }

    function addStatRow(k="", v=50) {
        const div = document.createElement('div');
        div.className = "stat-row";
        div.style = "display:flex; gap:10px; margin-top:5px;";
        div.innerHTML = `<input type="text" value="${k}" class="sk" placeholder="Stat"> <input type="number" value="${v}" class="sv" style="width:80px">`;
        document.getElementById('ed-stats-area').appendChild(div);
    }

    async function save() {
        const stats = {};
        document.querySelectorAll('.stat-row').forEach(row => {
            const k = row.querySelector('.sk').value;
            const v = row.querySelector('.sv').value;
            if(k) stats[k] = parseInt(v);
        });
        const censored = Array.from(document.querySelectorAll('#censure-checks input:checked')).map(cb => cb.value);

        const p = {
            id: document.getElementById('ed-id').value,
            prenom: document.getElementById('ed-prenom').value,
            nom: document.getElementById('ed-nom').value,
            categories: ["User"], status: "Actif",
            bio: document.getElementById('ed-bio').value,
            avatar: document.getElementById('ed-avatar').value,
            stats: stats, profile_pass: document.getElementById('ed-pass').value,
            profession: document.getElementById('ed-job').value,
            localisation: document.getElementById('ed-loc').value,
            niveau: "N/A", admin_code: ADMIN_CODE, censored: censored
        };

        await fetch(`${API}/update`, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(p)});
        closeProfile(); loadPublic();
    }

    function askAdmin() {
        const p = prompt("Code Admin :");
        if(p === "ExpA22") {
            ADMIN_CODE = p;
            document.getElementById('admin-btn').innerText = "Admin ‚úÖ";
            document.getElementById('btn-new').style.display = "block";
        }
    }

    function openNew() {
        renderProfile({id:"", prenom:"", nom:"", bio:"", avatar:"", stats:{}, profession:"", localisation:"", censored:[], password:""});
        document.getElementById('ed-id').disabled = false;
    }

    function closeProfile() { document.getElementById('profile-page').style.display = "none"; }
    loadPublic();
</script>
</body>
</html>
